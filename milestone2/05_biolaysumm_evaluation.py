# -*- coding: utf-8 -*-
"""BioLaySumm_Evaluation.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1jPQaYNLIz5M6psvta7xpKVer0wugz2k0
"""

import numpy as np
import torch
import torch.nn as nn
from tqdm import tqdm
from sklearn import preprocessing
import joblib
from torch.optim import AdamW

from google.colab import drive

drive.mount("/content/drive")

# DEVICE = "cpu"
# if torch.cuda.is_available():
#     DEVICE = torch.device("cuda:0")
#     print("Running on GPU")
# else:
#     print("Running on CPU")

"""Setup the evaluation script"""

# run once only to setup the models folder
# will take quite awhile to run (dependening on network speed but usually takes around 15 minutes)
!bash /content/drive/MyDrive/BioLaySumm2024-evaluation_scripts/get_models.sh

# os.chdir('/content/drive/MyDrive/BioLaySumm2024-evaluation_scripts')
# os.getcwd()

# os.chdir('/content/drive')
# os.getcwd()

#set up the enviornment for running evaluate.py
!pip install -r /content/drive/MyDrive/BioLaySumm2024-evaluation_scripts/requirements.txt

import os
os.environ['CUBLAS_WORKSPACE_CONFIG'] = ':4096:8'

"""# Evaluation
- It will take around 11 hours to run.  
- The outputs will be saved in the root directory.  

Provided evaluation code:  
- evaluate.py

Calling the code in nb:  
`!python PATH/TO/evaluate.py /path/to/predicted/summaries /path/to/validation/data`

Outputs:
1. /content/summac_conv_vitc_sent_perc_e.bin
2. /content/elife_scores.txt
3. /content/plos_scores.txt
4. /content/scores.txt
"""

!python /content/drive/MyDrive/BioLaySumm2024-evaluation_scripts/evaluate.py /content/drive/MyDrive/BioLaySumm2024-evaluation_scripts/baseline_evaluation /content/drive/MyDrive/BioLaySumm2024-evaluation_scripts/baseline_evaluation

